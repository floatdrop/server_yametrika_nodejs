# Серверное отслеживание посетителей с помощью Яндекс.Метрики для nodejs

В некоторых случаях требуется отслеживать действия на стороне сервера.

Например:
+ Слежка за поисковыми роботами
+ Редиректы
+ Загрузка файлов
+ Страницы с ошибками (403, 404, 500)
+ RSS
+ Время выполнения скриптов
+ Время запросов к базам данных
+ Треккинг AJAX-запросов
+ и пр.

## Возможности
+ Загрузка страницы - hit()
+ Внешняя ссылка - extLink()
+ Загрузка файла - file()
+ Параметры визита - params()
+ Неотказ - notBounce()

## Настройки счётчика Метрики
**В настройках счётчика во вкладке "Фильтры" / "Фильтрация роботов" необходимо выбрать опцию "Учитывать посещения всех роботов". В противном случае, статистика собираться не будет.**

## Ограничения
Отчёты, которые будут недоступны в Метрике при серверной отправки:
+ Половозрастная структура
+ Пол и возраст
+ Разрешения дисплеев
+ Версия Flash и Silverlight
+ Вебвизор, аналитика форм
+ Карта кликов

Уникальные посетители считаются по User Agent и IP-адресу.

## Установка
`npm install yametrika`

## Использование
  ```JavaScript
var http = require('http');

// Создаем счётчик, 12345 - номер счётчика
var counter = require('yametrika').counter({id: 12345});

http.createServer(function (req, res) {
    res.writeHead(200, {'Content-Type': 'text/plain'});
    res.end('okay');
  
    // Заполняем нужные данные из запроса к серверу для отправки данных в Метрику
    counter.req(req);
    
    // Страница http://example.com, с заголовком 'Main page', переход был с 'http://google.com' (реферер)
    counter.hit('http://example.com', 'Main page', 'http://google.com');
}).listen(8080);  
  ```